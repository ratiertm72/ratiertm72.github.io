<!doctype html><html lang=ko><meta charset=utf-8><meta content=ie=edge http-equiv=x-ua-compatible><meta name=description><meta content=width=device-width,height=device-height,initial-scale=1 name=viewport><title>lchfkorea</title><meta content=phoenix name=tags><meta content=elixir name=tags><meta content=plug name=tags><meta content=lchfkorea property=og:site_name><meta content=article property=og:type><meta content="A Phoenix Plug for assigning template variables" property=og:title><meta content=./a-phoenix-plug-for-assigning-template-variables.html property=og:url><meta content="Here's a quick Plug for a Phoenix project that allows you to quickly and easily set template variables (assigns) in either a Pipeline or for all actions in a controller. I used this recently as a way to set a variable, admin: true, for all of my controllers under an …" property=og:description><meta content=2015-10-05 property=article:published_time><meta content=Web property=article:section><meta content=phoenix property=article:tag><meta content=elixir property=article:tag><meta content=plug property=article:tag><meta content="DongBuem Lee" property=article:author><meta content=./images/phoenix/plug_small.jpg property=og:image><link href=./theme/icons/apple-touch-icon-57x57.png rel=apple-touch-icon sizes=57x57><link href=./theme/icons/apple-touch-icon-60x60.png rel=apple-touch-icon sizes=60x60><link href=./theme/icons/apple-touch-icon-72x72.png rel=apple-touch-icon sizes=72x72><link href=./theme/icons/apple-touch-icon-76x76.png rel=apple-touch-icon sizes=76x76><link href=./theme/icons/apple-touch-icon-114x114.png rel=apple-touch-icon sizes=114x114><link href=./theme/icons/apple-touch-icon-120x120.png rel=apple-touch-icon sizes=120x120><link href=./theme/icons/apple-touch-icon-144x144.png rel=apple-touch-icon sizes=144x144><link href=./theme/icons/apple-touch-icon-152x152.png rel=apple-touch-icon sizes=152x152><link href=./theme/icons/apple-touch-icon-180x180.png rel=apple-touch-icon sizes=180x180><link href=./theme/icons/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=./theme/icons/android-chrome-192x192.png rel=icon sizes=192x192 type=image/png><link href=./theme/icons/favicon-96x96.png rel=icon sizes=96x96 type=image/png><link href=./theme/icons/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=./theme/icons/manifest.json rel=manifest><link rel="shortcut icon" href=./theme/icons/favicon.ico><meta content=#00aba9 name=msapplication-TileColor><meta content=theme/icons/mstile-144x144.png name=msapplication-TileImage><meta content=theme/icons/browserconfig.xml name=msapplication-config><meta content=#ffffff name=theme-color><link href=https://fonts.googleapis.com/css?family=Open+Sans:400,700|Oswald:400,700 rel=stylesheet><link href=https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css rel=stylesheet><link href=./theme/styles/theme.css rel=stylesheet><body><header id=main-header><ul id=main-menu role=nav><li><a href=./category/graphics.html>Graphics</a><li><a href=./category/misc.html>misc</a><li><a href=./category/mobile.html>Mobile</a><li class=active><a href=./category/web.html>Web</a></ul><section id=masthead><img src=./theme/images/toaster.png><h1><a href=./>lchfkorea</a></h1><p>first trys by MindBuild</section></header><header class="jumbo dark" id=article-header><div id=jumbo-image style=background-image:url(./images/phoenix/plug.jpg)></div><div id=jumbo-attribution>Image courtesy <a href=https://www.flickr.com/photos/eklektikos/371357839 target=_blank> Todd Ehlers </a></div><div id=title><h2><a title="Permalink to A Phoenix Plug for assigning template variables" href=./a-phoenix-plug-for-assigning-template-variables.html rel=bookmark> A Phoenix Plug for assigning template variables </a></h2><footer><time class=published datetime=2015-10-05T00:00:00+09:00>10월 5, 2015</time></footer></div></header><section id=article><div class=markdown id=article-content><p>Here's a quick <a href=http://www.phoenixframework.org/v0.11.0/docs/understanding-plug>Plug</a> for a <a href=http://www.phoenixframework.org/>Phoenix</a> project that allows you to quickly and easily set template variables (assigns) in either a <a href=http://www.phoenixframework.org/docs/routing>Pipeline</a> or for all actions in a controller. I used this recently as a way to set a variable, <code>admin: true</code>, for all of my controllers under an <code>/admin</code> scope. I also used it to set a <code>subsection</code> variable for the different controllers that make up the different parts of the site so that my Layout template could mark which section of the site the user was currently on in the site navigation header.<blockquote><p><em><strong>Update 10/14/15</strong>: I went ahead and published this as a self-contained hex package, if nothing else than as an exercise in publishing things. It's <a href=https://hex.pm/packages/plug_assign/1.0.0>available on hex.pm</a>. Note that I renamed it to <code>Plug.Assign</code> to better match existing Plug names.</em></blockquote><h3>The Plug</h3><p>The Plug itself is very straightforward since we're able to exploit the fact that Phoenix just uses Plug's <a href=http://hexdocs.pm/plug/Plug.Conn.html#t:assigns/0><code>assigns</code></a> map that is part of the <a href=http://hexdocs.pm/plug/Plug.Conn.html><code>Plug.Conn</code></a> struct as the holding place for template context variables. Thus we can assign our own variables as part of the Plug stack before the Controller action (which itself is just a plug) even executes. So our first step is going to be creating the plug.<p>As an interface, our plug will accept a map of key/value pairs, exactly like the <a href=http://hexdocs.pm/phoenix/Phoenix.Controller.html#render/3><code>render/3</code></a> function in a Controller/View. So as an example, it will look like:<div class=highlight><pre><span></span><code><span class=n>plug</span><span class=w> </span><span class=nc>Plugs.Assigns</span><span class=p>,</span><span class=w> </span><span class=ss>foo</span><span class=p>:</span><span class=w> </span><span class=s2>"This is foo"</span><span class=p>,</span><span class=w> </span><span class=ss>bar</span><span class=p>:</span><span class=w> </span><span class=no>true</span><span class=p>,</span><span class=w> </span><span class=ss>baz</span><span class=p>:</span><span class=w> </span><span class=mi>5</span>
</code></pre></div><p>I decided to put it in <code>lib/plugs</code> and named the source file <code>assigns.ex</code> so that my module name will be <code>Plugs.Assigns</code>. This way I can easily copy this plug to other projects. It could even be packaged up as a Hex package and installed as a dependency. So <code>lib/plugs/assigns.ex</code> will look like:<div class=highlight><pre><span></span><code><span class=kd>defmodule</span><span class=w> </span><span class=nc>Plugs.Assigns</span><span class=w> </span><span class=k>do</span>
<span class=w>    </span><span class=kn>import</span><span class=w> </span><span class=nc>Plug.Conn</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=n>init</span><span class=p>(</span><span class=n>assigns</span><span class=p>),</span><span class=w> </span><span class=ss>do</span><span class=p>:</span><span class=w> </span><span class=n>assigns</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=n>call</span><span class=p>(</span><span class=n>conn</span><span class=p>,</span><span class=w> </span><span class=n>assigns</span><span class=p>)</span><span class=w> </span><span class=k>do</span>
<span class=w>        </span><span class=nc>Enum</span><span class=o>.</span><span class=n>reduce</span><span class=w> </span><span class=n>assigns</span><span class=p>,</span><span class=w> </span><span class=n>conn</span><span class=p>,</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=p>{</span><span class=n>k</span><span class=p>,</span><span class=w> </span><span class=n>v</span><span class=p>},</span><span class=w> </span><span class=n>conn</span><span class=w> </span><span class=o>-></span>
<span class=w>            </span><span class=nc>Plug.Conn</span><span class=o>.</span><span class=n>assign</span><span class=p>(</span><span class=n>conn</span><span class=p>,</span><span class=w> </span><span class=n>k</span><span class=p>,</span><span class=w> </span><span class=n>v</span><span class=p>)</span>
<span class=w>        </span><span class=k>end</span>
<span class=w>    </span><span class=k>end</span>
<span class=k>end</span>
</code></pre></div><p>If you're not familiar with the <a href=http://hexdocs.pm/plug/Plug.html>Plug spec</a>, two functions are required, <code>init/1</code> and <code>call/2</code>. We don't need to do anything with the map at initialization time, so our <code>init/1</code> function just returns it. However, for each request, our <code>call/2</code> function will take the <code>assigns</code> map and add it to the <code>conn</code>. This could possibly be written more efficiently by directly manipulating the <code>assigns</code> map in the <code>Plug.Conn</code> struct <code>conn</code>, but I opted to use the interface so that it uses the public <a href=http://hexdocs.pm/plug/Plug.Conn.html#assign/3><code>Plug.Conn.assign</code></a> function, making it more compatible with possible future changes to Plug.<h3>Using in a Pipeline</h3><p>Let's say you want to assign a variable <code>admin</code> to either <code>true</code> if the current request is being routed to an <code>/admin</code> scope. For example, you have something like this defined in your <code>routers.ex</code>:<div class=highlight><pre><span></span><code><span class=kd>defmodule</span><span class=w> </span><span class=nc>Blog.Router</span><span class=w> </span><span class=k>do</span>
<span class=w>  </span><span class=kn>use</span><span class=w> </span><span class=nc>Blog.Web</span><span class=p>,</span><span class=w> </span><span class=ss>:router</span>

<span class=w>  </span><span class=n>pipeline</span><span class=w> </span><span class=ss>:browser</span><span class=w> </span><span class=k>do</span>
<span class=w>    </span><span class=n>plug</span><span class=w> </span><span class=ss>:accepts</span><span class=p>,</span><span class=w> </span><span class=p>[</span><span class=s2>"html"</span><span class=p>]</span>
<span class=w>    </span><span class=n>plug</span><span class=w> </span><span class=ss>:fetch_session</span>
<span class=w>    </span><span class=n>plug</span><span class=w> </span><span class=ss>:fetch_flash</span>
<span class=w>    </span><span class=n>plug</span><span class=w> </span><span class=ss>:protect_from_forgery</span>
<span class=w>    </span><span class=n>plug</span><span class=w> </span><span class=ss>:put_secure_browser_headers</span>
<span class=w>  </span><span class=k>end</span>

<span class=w>  </span><span class=n>scope</span><span class=w> </span><span class=s2>"/"</span><span class=p>,</span><span class=w> </span><span class=nc>Blog</span><span class=w> </span><span class=k>do</span>
<span class=w>    </span><span class=n>pipe_through</span><span class=w> </span><span class=ss>:browser</span><span class=w> </span><span class=c1># Use the default browser stack</span>

<span class=w>    </span><span class=n>get</span><span class=w> </span><span class=s2>"/"</span><span class=p>,</span><span class=w> </span><span class=nc>PageController</span><span class=p>,</span><span class=w> </span><span class=ss>:index</span>
<span class=w>    </span><span class=n>get</span><span class=w> </span><span class=s2>"/post/:post_id"</span><span class=p>,</span><span class=w> </span><span class=nc>PageController</span><span class=p>,</span><span class=w> </span><span class=ss>:post</span>
<span class=w>  </span><span class=k>end</span>

<span class=w>  </span><span class=n>scope</span><span class=w> </span><span class=s2>"/admin"</span><span class=p>,</span><span class=w> </span><span class=nc>Blog.Admin</span><span class=w> </span><span class=k>do</span>
<span class=w>    </span><span class=n>pipe_through</span><span class=w> </span><span class=ss>:browser</span><span class=w> </span><span class=c1># Use the default browser stack</span>

<span class=w>    </span><span class=n>resources</span><span class=w> </span><span class=s2>"/posts"</span><span class=p>,</span><span class=w> </span><span class=nc>PostController</span>
<span class=w>    </span><span class=n>resources</span><span class=w> </span><span class=s2>"/users"</span><span class=p>,</span><span class=w> </span><span class=nc>UserController</span>
<span class=w>  </span><span class=k>end</span>
<span class=k>end</span>
</code></pre></div><p>Now let's say you would like to modify your <code>layout/app.html.eex</code> template so that it has "Admin: " prefixed to the page title, as an example.<div class=highlight><pre><span></span><code><span class=nt>&LTtitle></span><span class=cp><%=</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=n>assigns</span><span class=o>[</span><span class=ss>:admin</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=k>do</span><span class=p>:</span><span class=w> </span><span class=s2>"Admin: "</span><span class=w> </span><span class=cp>%></span>My<span class=w> </span>Blog!<span class=nt>&LT/title></span>
</code></pre></div><p>We would do this by defining a new pipeline in <code>router.ex</code>, and call it <code>:admin</code>:<div class=highlight><pre><span></span><code><span class=n>pipeline</span><span class=w> </span><span class=ss>:admin</span><span class=w> </span><span class=k>do</span>
<span class=w>  </span><span class=n>plug</span><span class=w> </span><span class=nc>Plugs.Assigns</span><span class=p>,</span><span class=w> </span><span class=p>%{</span><span class=ss>admin</span><span class=p>:</span><span class=w> </span><span class=no>true</span><span class=p>}</span>
<span class=k>end</span>
</code></pre></div><p>And then we can modify our <code>/admin</code> scope to use it.<div class=highlight><pre><span></span><code><span class=n>scope</span><span class=w> </span><span class=s2>"/admin"</span><span class=p>,</span><span class=w> </span><span class=nc>Blog.Admin</span><span class=w> </span><span class=k>do</span>
<span class=w>  </span><span class=n>pipe_through</span><span class=w> </span><span class=p>[</span><span class=ss>:browser</span><span class=p>,</span><span class=w> </span><span class=ss>:admin</span><span class=p>]</span><span class=w> </span><span class=c1># Use admin stack as well</span>

<span class=w>  </span><span class=n>resources</span><span class=w> </span><span class=s2>"/posts"</span><span class=p>,</span><span class=w> </span><span class=nc>PostController</span>
<span class=w>  </span><span class=n>resources</span><span class=w> </span><span class=s2>"/users"</span><span class=p>,</span><span class=w> </span><span class=nc>UserController</span>
<span class=k>end</span>
</code></pre></div><p>Now all requests to any controller under <code>/admin</code> will include the variable <code>admin: true</code>.<h3>Using it to assign a variable for all Controllers</h3><p>Another way to use this would be to set a variable for all action functions in a Controller. To continue our example, in our <code>web/controllers/admin/post_controller.ex</code> file, we could just add a plug call to our custom Plug near the top.<div class=highlight><pre><span></span><code><span class=kd>defmodule</span><span class=w> </span><span class=nc>Blog.Admin.PostController</span><span class=w> </span><span class=k>do</span>
<span class=w>  </span><span class=kn>use</span><span class=w> </span><span class=nc>Blog.Web</span><span class=p>,</span><span class=w> </span><span class=ss>:controller</span>

<span class=w>  </span><span class=kn>alias</span><span class=w> </span><span class=nc>Blog.Post</span>

<span class=w>  </span><span class=n>plug</span><span class=w> </span><span class=ss>:scrub_params</span><span class=p>,</span><span class=w> </span><span class=s2>"post"</span><span class=w> </span><span class=ow>when</span><span class=w> </span><span class=n>action</span><span class=w> </span><span class=ow>in</span><span class=w> </span><span class=p>[</span><span class=ss>:create</span><span class=p>,</span><span class=w> </span><span class=ss>:update</span><span class=p>]</span>
<span class=w>  </span><span class=n>plug</span><span class=w> </span><span class=nc>Plugs.Assigns</span><span class=p>,</span><span class=w> </span><span class=ss>subsection</span><span class=p>:</span><span class=w> </span><span class=ss>:posts</span>

<span class=w>  </span><span class=n>...</span>
<span class=k>end</span>
</code></pre></div><p>Our corresponding template could check if the <code>subsection</code> variable is set to something specific to enable a visual indication of what subsection the user is currently in.<div class=highlight><pre><span></span><code><span class=nt>&LTli</span><span class=w> </span><span class=na>class=</span><span class=s>"</span><span class=cp><%=</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=n>assigns</span><span class=o>[</span><span class=ss>:subsection</span><span class=o>]</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=ss>:posts</span><span class=w> </span><span class=k>do</span><span class=w> </span><span class=s2>"active"</span><span class=w> </span><span class=k>end</span><span class=w> </span><span class=cp>%></span><span class=s>"</span><span class=nt>></span>
<span class=w>    </span><span class=nt>&LTa</span><span class=w> </span><span class=na>href=</span><span class=s>"</span><span class=cp><%=</span><span class=w> </span><span class=n>post_path</span><span class=p>(</span><span class=vi>@conn</span><span class=p>,</span><span class=w> </span><span class=ss>:index</span><span class=p>)</span><span class=w> </span><span class=cp>%></span><span class=s>"</span><span class=nt>></span>Posts<span class=nt>&LT/a></span>
<span class=nt>&LT/li></span>
</code></pre></div><p>If you wanted to limit the plug to only certain actions, this could be done by adding a <code>when</code> clause. However, do note that when you do that, the map of assigns will no longer be the last predicate, and so you need to wrap it in a map operator, <code>%{}</code>.<div class=highlight><pre><span></span><code><span class=n>plug</span><span class=w> </span><span class=nc>Plugs.Assigns</span><span class=p>,</span><span class=w> </span><span class=p>%{</span><span class=ss>subsection</span><span class=p>:</span><span class=w> </span><span class=ss>:posts</span><span class=p>}</span><span class=w> </span><span class=ow>when</span><span class=w> </span><span class=n>action</span><span class=w> </span><span class=ow>in</span><span class=w> </span><span class=p>[</span><span class=ss>:index</span><span class=p>,</span><span class=w> </span><span class=ss>:show</span><span class=p>]</span>
</code></pre></div><p>Now the <code>subsection</code> variable will only be set to <code>:posts</code> when the user is calling the <code>:index</code> and <code>:show</code> actions.<p>So there's an example of how powerful the Plug interface is, and how it allows you to add so much functionality with almost no code.</div><section id=share-buttons><h3>Share this:</h3><ul><li><a class="btn btn-facebook" href="https://www.facebook.com/sharer/sharer.php?u=./a-phoenix-plug-for-assigning-template-variables.html&t=A Phoenix Plug for assigning template variables" title="Share on Facebook" target=_blank> <i class="fa fa-facebook"></i> Facebook </a><li><a class="btn btn-twitter" href="https://twitter.com/intent/tweet?source=./a-phoenix-plug-for-assigning-template-variables.html&text=A Phoenix Plug for assigning template variables" target=_blank title=Tweet> <i class="fa fa-twitter"></i> Twitter </a><li><a class="btn btn-reddit" href="http://www.reddit.com/submit?url=./a-phoenix-plug-for-assigning-template-variables.html&title=A Phoenix Plug for assigning template variables" title="Submit to Reddit" target=_blank> <i class="fa fa-reddit"></i> Reddit </a><li><a class="btn btn-email" href="mailto:?subject=A Phoenix Plug for assigning template variables&body=Article+from+lchfkorea%0D%0A%0D%0A./a-phoenix-plug-for-assigning-template-variables.html%0D%0A%0D%0AHere's a quick Plug for a Phoenix project that allows you to quickly and easily set template variables (assigns) in either a Pipeline or for all actions in a controller. I used this recently as a way to set a variable, admin: true, for all of my controllers under an …" target=_blank title=Email> <i class="fa fa-envelope"></i> Email </a></ul></section></section><footer id=main-footer><section id=links><section><h3>Pages</h3><ul><li><a href=./>Home</a><li><a href=./archives.html>Archives</a><li><a href=./pages/colophon.html>Colophon</a></ul></section><section><h3>Categories</h3><ul><li><a href=./category/graphics.html>Graphics</a><li><a href=./category/misc.html>misc</a><li><a href=./category/mobile.html>Mobile</a><li><a href=./category/web.html>Web</a></ul></section><section><h3>Tags</h3><ul class=tag-cloud><li class=tag-1><a href=./tag/android.html>android</a><li class=tag-1><a href=./tag/css.html>css</a><li class="tag-1 tag-2"><a href=./tag/django.html>django</a><li class=tag-1><a href=./tag/docker.html>docker</a><li class="tag-1 tag-2"><a href=./tag/elixir.html>elixir</a><li class="tag-1 tag-2 tag-3"><a href=./tag/gideros.html>gideros</a><li class=tag-1><a href=./tag/gulp.html>gulp</a><li class=tag-1><a href=./tag/ios.html>ios</a><li class="tag-1 tag-2 tag-3 tag-4"><a href=./tag/lua.html>lua</a><li class="tag-1 tag-2"><a href=./tag/math.html>math</a><li class=tag-1><a href=./tag/pelican.html>pelican</a><li class="tag-1 tag-2"><a href=./tag/phoenix.html>phoenix</a><li class=tag-1><a href=./tag/plug.html>plug</a><li class="tag-1 tag-2"><a href=./tag/postgres.html>postgres</a><li class=tag-1><a href=./tag/pycharm.html>pycharm</a><li class=tag-1><a href=./tag/responsive.html>responsive</a><li class=tag-1><a href=./tag/sass.html>sass</a><li class=tag-1><a href=./tag/sublime-text.html>sublime-text</a><li class=tag-1><a href=./tag/web-design.html>web design</a></ul></section><address><h3>Nathan Shafer</h3> <ul><li><a href=https://www.github.com/nshafer>Github</a><li><a href=http://www.normal-tech.com>Normal Technologies LLC</a><li><a href=http://www.typeingames.com>Type-in Games</a></ul></address></section><section id=subfooter><section id=copyright><p>© 2025 Nathan Shafer<p id=license>All work is licensed under a <a href=http://creativecommons.org/licenses/by/4.0/ rel=license>Creative Commons Attribution 4.0 International License</a> unless otherwise specified.</section><a title="Subscribe to my feed" href=http://feeds.feedburner.com/Lotechnica id=subscribe-link rel=alternate type=application/rss+xml> <img alt src=//feedburner.google.com/fb/images/pub/feed-icon32x32.png style=border:0> </a></section></footer>