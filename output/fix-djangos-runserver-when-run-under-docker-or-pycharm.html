<!doctype html><html lang=ko><meta charset=utf-8><meta content=ie=edge http-equiv=x-ua-compatible><meta name=description><meta content=width=device-width,height=device-height,initial-scale=1 name=viewport><title>lchfkorea</title><meta content=django name=tags><meta content=docker name=tags><meta content=pycharm name=tags><meta content=lchfkorea property=og:site_name><meta content=article property=og:type><meta content="Fix Django's runserver when run under Docker or PyCharm" property=og:title><meta content=./fix-djangos-runserver-when-run-under-docker-or-pycharm.html property=og:url><meta content="When running Django's runserver management command in a Docker container or under a PyCharm run configuration (in Linux at least), I very often had issues with the process not getting killed in a timely manner. The symptom is that the process doesn't die immediately after it receives a SIGTERM or …" property=og:description><meta content=2016-03-14 property=article:published_time><meta content=Web property=article:section><meta content=django property=article:tag><meta content=docker property=article:tag><meta content=pycharm property=article:tag><meta content="DongBuem Lee" property=article:author><link href=./theme/icons/apple-touch-icon-57x57.png rel=apple-touch-icon sizes=57x57><link href=./theme/icons/apple-touch-icon-60x60.png rel=apple-touch-icon sizes=60x60><link href=./theme/icons/apple-touch-icon-72x72.png rel=apple-touch-icon sizes=72x72><link href=./theme/icons/apple-touch-icon-76x76.png rel=apple-touch-icon sizes=76x76><link href=./theme/icons/apple-touch-icon-114x114.png rel=apple-touch-icon sizes=114x114><link href=./theme/icons/apple-touch-icon-120x120.png rel=apple-touch-icon sizes=120x120><link href=./theme/icons/apple-touch-icon-144x144.png rel=apple-touch-icon sizes=144x144><link href=./theme/icons/apple-touch-icon-152x152.png rel=apple-touch-icon sizes=152x152><link href=./theme/icons/apple-touch-icon-180x180.png rel=apple-touch-icon sizes=180x180><link href=./theme/icons/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=./theme/icons/android-chrome-192x192.png rel=icon sizes=192x192 type=image/png><link href=./theme/icons/favicon-96x96.png rel=icon sizes=96x96 type=image/png><link href=./theme/icons/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=./theme/icons/manifest.json rel=manifest><link rel="shortcut icon" href=./theme/icons/favicon.ico><meta content=#00aba9 name=msapplication-TileColor><meta content=theme/icons/mstile-144x144.png name=msapplication-TileImage><meta content=theme/icons/browserconfig.xml name=msapplication-config><meta content=#ffffff name=theme-color><link href=https://fonts.googleapis.com/css?family=Open+Sans:400,700|Oswald:400,700 rel=stylesheet><link href=https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css rel=stylesheet><link href=./theme/styles/theme.css rel=stylesheet><body><header id=main-header><ul id=main-menu role=nav><li><a href=./category/graphics.html>Graphics</a><li><a href=./category/misc.html>misc</a><li><a href=./category/mobile.html>Mobile</a><li class=active><a href=./category/web.html>Web</a></ul><section id=masthead><img src=./theme/images/toaster.png><h1><a href=./>lchfkorea</a></h1><p>first trys by MindBuild</section></header><header id=article-header><div id=title><h2><a title="Permalink to Fix Django's runserver when run under Docker or PyCharm" href=./fix-djangos-runserver-when-run-under-docker-or-pycharm.html rel=bookmark> Fix Django's runserver when run under Docker or PyCharm </a></h2><footer><time class=published datetime=2016-03-14T00:00:00+09:00>3월 14, 2016</time></footer></div></header><section id=article><div class=markdown id=article-content><p>When running Django's <code>runserver</code> management command in a Docker container or under a PyCharm run configuration (in Linux at least), I very often had issues with the process not getting killed in a timely manner. The symptom is that the process doesn't die immediately after it receives a SIGTERM or SIGINT. This is very puzzling, as hitting <code>ctrl-c</code> in a terminal kills it immediately like it's supposed to. There doesn't seem to be any reason for it to not die.<p>When run in a Docker container, such as part of a Docker Compose service, the symptom is that doing a <code>docker-compose stop</code> takes over 10 seconds to complete. It's really annoying when you're doing a lot of iteration testing of a compose config and want to <code>up</code>/<code>down</code> a lot.<p>Under PyCharm, the problem is that hitting Stop on the configuration doesn't seem to work at all, and instead you have to hit the skull icon that appears when the stop fails to happen within a second or so. Not that bad, but annoying none-the-less, especially if you're switching from Run to Debug and back on a regular basis.<p>Either way, it's the little things that are annoying and distracting from getting your real work done. So I dug into it a little, and I think I have a fix.<h2>The quick fix</h2><p>The quick fix is to specifically listen for <code>SIGINT</code> and <code>SIGTERM</code> in your manage.py, and <code>sys.kill()</code> when you get them. So modify your manage.py to add a signal handler:<div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>sighandler</span><span class=p>(</span><span class=n>signum</span><span class=p>,</span> <span class=n>frame</span><span class=p>):</span>
    <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</code></pre></div><p>Then install that signal handler as part of the <code>__main__</code> code:<div class=highlight><pre><span></span><code><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>"__main__"</span><span class=p>:</span>
    <span class=n>signal</span><span class=o>.</span><span class=n>signal</span><span class=p>(</span><span class=n>signal</span><span class=o>.</span><span class=n>SIGTERM</span><span class=p>,</span> <span class=n>sighandler</span><span class=p>)</span>
    <span class=n>signal</span><span class=o>.</span><span class=n>signal</span><span class=p>(</span><span class=n>signal</span><span class=o>.</span><span class=n>SIGINT</span><span class=p>,</span> <span class=n>sighandler</span><span class=p>)</span>
</code></pre></div><p>So here is an example of a complete manage.py, based on the skeleton version you get from <code>django-admin startproject</code> with Django 1.9.<div class=highlight><pre><span></span><code><span class=ch>#!/usr/bin/env python</span>
<span class=kn>import</span> <span class=nn>os</span>
<span class=kn>import</span> <span class=nn>sys</span>
<span class=kn>import</span> <span class=nn>signal</span>


<span class=k>def</span> <span class=nf>sighandler</span><span class=p>(</span><span class=n>signum</span><span class=p>,</span> <span class=n>frame</span><span class=p>):</span>
    <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>

<span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>"__main__"</span><span class=p>:</span>
    <span class=n>signal</span><span class=o>.</span><span class=n>signal</span><span class=p>(</span><span class=n>signal</span><span class=o>.</span><span class=n>SIGTERM</span><span class=p>,</span> <span class=n>sighandler</span><span class=p>)</span>
    <span class=n>signal</span><span class=o>.</span><span class=n>signal</span><span class=p>(</span><span class=n>signal</span><span class=o>.</span><span class=n>SIGINT</span><span class=p>,</span> <span class=n>sighandler</span><span class=p>)</span>
    <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=s2>"DJANGO_SETTINGS_MODULE"</span><span class=p>,</span> <span class=s2>"myproject.settings"</span><span class=p>)</span>

    <span class=kn>from</span> <span class=nn>django.core.management</span> <span class=kn>import</span> <span class=n>execute_from_command_line</span>

    <span class=n>execute_from_command_line</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span>
</code></pre></div><h2>The why</h2><p>You know, I've looked into this a little bit, and written all kinds of test code to try to suss out exactly what is happening, but I can't really make heads or tails of it. The problem still persists if you use <code>--noreload</code> so that <code>runserver</code> doesn't use the autoreloader code, which uses threading. So it's not a clash between signals and threads, which is typically a problem. Conversely, when I try to narrow it down to issues with only the parent process getting the signal, or only the child, or it being a process group in the shell but not in Docker or PyCharm, I get conflicting results that don't seem to point to a clear explanation. I think understanding it would require a lot more time, and a lot more expertise into the bowels of CPython and the shell vs Docker's simplified environment or exactly how PyCharm execs your commands from Java. For now, having a quick fix is enough. If anyone knows what's going on, please enlighten me.</div><section id=share-buttons><h3>Share this:</h3><ul><li><a class="btn btn-facebook" href="https://www.facebook.com/sharer/sharer.php?u=./fix-djangos-runserver-when-run-under-docker-or-pycharm.html&t=Fix Django's runserver when run under Docker or PyCharm" title="Share on Facebook" target=_blank> <i class="fa fa-facebook"></i> Facebook </a><li><a class="btn btn-twitter" href="https://twitter.com/intent/tweet?source=./fix-djangos-runserver-when-run-under-docker-or-pycharm.html&text=Fix Django's runserver when run under Docker or PyCharm" target=_blank title=Tweet> <i class="fa fa-twitter"></i> Twitter </a><li><a class="btn btn-reddit" href="http://www.reddit.com/submit?url=./fix-djangos-runserver-when-run-under-docker-or-pycharm.html&title=Fix Django's runserver when run under Docker or PyCharm" title="Submit to Reddit" target=_blank> <i class="fa fa-reddit"></i> Reddit </a><li><a class="btn btn-email" href="mailto:?subject=Fix Django's runserver when run under Docker or PyCharm&body=Article+from+lchfkorea%0D%0A%0D%0A./fix-djangos-runserver-when-run-under-docker-or-pycharm.html%0D%0A%0D%0AWhen running Django's runserver management command in a Docker container or under a PyCharm run configuration (in Linux at least), I very often had issues with the process not getting killed in a timely manner. The symptom is that the process doesn't die immediately after it receives a SIGTERM or …" target=_blank title=Email> <i class="fa fa-envelope"></i> Email </a></ul></section></section><footer id=main-footer><section id=links><section><h3>Pages</h3><ul><li><a href=./>Home</a><li><a href=./archives.html>Archives</a><li><a href=./pages/colophon.html>Colophon</a></ul></section><section><h3>Categories</h3><ul><li><a href=./category/graphics.html>Graphics</a><li><a href=./category/misc.html>misc</a><li><a href=./category/mobile.html>Mobile</a><li><a href=./category/web.html>Web</a></ul></section><section><h3>Tags</h3><ul class=tag-cloud><li class=tag-1><a href=./tag/android.html>android</a><li class=tag-1><a href=./tag/css.html>css</a><li class="tag-1 tag-2"><a href=./tag/django.html>django</a><li class=tag-1><a href=./tag/docker.html>docker</a><li class="tag-1 tag-2"><a href=./tag/elixir.html>elixir</a><li class="tag-1 tag-2 tag-3"><a href=./tag/gideros.html>gideros</a><li class=tag-1><a href=./tag/gulp.html>gulp</a><li class=tag-1><a href=./tag/ios.html>ios</a><li class="tag-1 tag-2 tag-3 tag-4"><a href=./tag/lua.html>lua</a><li class="tag-1 tag-2"><a href=./tag/math.html>math</a><li class=tag-1><a href=./tag/pelican.html>pelican</a><li class="tag-1 tag-2"><a href=./tag/phoenix.html>phoenix</a><li class=tag-1><a href=./tag/plug.html>plug</a><li class="tag-1 tag-2"><a href=./tag/postgres.html>postgres</a><li class=tag-1><a href=./tag/pycharm.html>pycharm</a><li class=tag-1><a href=./tag/responsive.html>responsive</a><li class=tag-1><a href=./tag/sass.html>sass</a><li class=tag-1><a href=./tag/sublime-text.html>sublime-text</a><li class=tag-1><a href=./tag/web-design.html>web design</a></ul></section><address><h3>Nathan Shafer</h3> <ul><li><a href=https://www.github.com/nshafer>Github</a><li><a href=http://www.normal-tech.com>Normal Technologies LLC</a><li><a href=http://www.typeingames.com>Type-in Games</a></ul></address></section><section id=subfooter><section id=copyright><p>© 2025 Nathan Shafer<p id=license>All work is licensed under a <a href=http://creativecommons.org/licenses/by/4.0/ rel=license>Creative Commons Attribution 4.0 International License</a> unless otherwise specified.</section><a title="Subscribe to my feed" href=http://feeds.feedburner.com/Lotechnica id=subscribe-link rel=alternate type=application/rss+xml> <img alt src=//feedburner.google.com/fb/images/pub/feed-icon32x32.png style=border:0> </a></section></footer>